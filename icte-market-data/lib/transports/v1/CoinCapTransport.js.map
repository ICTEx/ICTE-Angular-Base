{"version":3,"sources":["lib.js"],"names":["Object","exports","CoinCapConstant_1","require","MsgFactory_1","MdConstant_1","MdUtils_1","WebSocket","CoinCapTransport","_0x3da55a","_0x4ba949","_0x4ffe4b","_0x8c485f","_0x498a45","_0x14fa5b","_0x28b4c0","_0x10b18a","_0x1309f8","_0x58c194","_0x4d43be","_0x4a730d","_0x82797","_0x3dd882","_0x59dbc4","_0x21a5dc","JSON","_0x10b436","_0x12d9be","Math"],"mappings":"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","sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar CoinCapConstant_1 = require(\"./CoinCapConstant\");\r\nvar MsgFactory_1 = require(\"./MsgFactory\");\r\nvar MdConstant_1 = require(\"../api/MdConstant\");\r\nvar MdUtils_1 = require(\"../api/MdUtils\");\r\nvar WebSocket = require('isomorphic-ws');\r\nvar CoinCapTransport = /** @class */ (function () {\r\n    function CoinCapTransport(callback) {\r\n        var _this = this;\r\n        this.subscriptions = {};\r\n        this.validIdList = [];\r\n        this._connected = false;\r\n        this.isConnected = function () {\r\n            return _this._connected;\r\n        };\r\n        this.connect = function (symbols) {\r\n            _this._connected = true;\r\n            _this.subscribe(symbols);\r\n            _this.setup();\r\n        };\r\n        this.cb = callback;\r\n    }\r\n    CoinCapTransport.prototype.subscribe = function (symbols) {\r\n        var uriList = \"\";\r\n        var first = true;\r\n        for (var i = 0; i < CoinCapConstant_1.CoinCapConstant.VALIDCOINS.length; i++) {\r\n            var symbol = CoinCapConstant_1.CoinCapConstant.VALIDCOINS[i].symbol;\r\n            var symbolId = MdConstant_1.MdConstant.COINS.indexOf(symbol);\r\n            var ccSymbolId = CoinCapConstant_1.CoinCapConstant.VALIDCOINS[i].id;\r\n            if (symbolId >= 0) {\r\n                this.validIdList[CoinCapConstant_1.CoinCapConstant.VALIDCOINS[i].id] = symbol;\r\n                this.subscriptions[ccSymbolId] = { symbol: symbol, id: symbolId };\r\n                if (!first) {\r\n                    uriList += ',';\r\n                }\r\n                first = false;\r\n                uriList += ccSymbolId;\r\n            }\r\n        }\r\n        this.coinCapUri = \"wss://ws.coincap.io/prices?assets=\" + uriList;\r\n    };\r\n    CoinCapTransport.prototype.setup = function () {\r\n        var _this = this;\r\n        this.socket = new WebSocket(this.coinCapUri);\r\n        this.socket.onmessage = function (msg) {\r\n            var cqMsg = MsgFactory_1.MsgFactory.priceMsg;\r\n            var data = JSON.parse(msg.data);\r\n            var keysList = Object.keys(data);\r\n            keysList.forEach(function (ccSymbolId) {\r\n                var price = data[ccSymbolId];\r\n                cqMsg.buffer(MdUtils_1.MdUtils.getMsSinceMidnight(), _this.subscriptions[ccSymbolId].id, Math.trunc(price), Math.trunc(price % 1 * 10000000), 0, 0, 0, 0, MdConstant_1.MdConstant.CoinCapTransport, 0);\r\n                _this.cb.on(cqMsg);\r\n            });\r\n        };\r\n    };\r\n    return CoinCapTransport;\r\n}());\r\nexports.CoinCapTransport = CoinCapTransport;\r\n"]}