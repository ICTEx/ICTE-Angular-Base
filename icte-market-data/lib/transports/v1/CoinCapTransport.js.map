{"version":3,"sources":["lib.js"],"names":["Object","exports","CoinCapConstant_1","require","MsgFactory_1","MdConstant_1","MdUtils_1","WebSocket","CoinCapTransport","_0xfdba86","_0x632dbb","_0x1f07cb","_0x3a9bb4","_0x19514c","_0x265372","_0xa30f7","_0x29200a","_0x5a077e","_0x4e92d1","_0x361b51","_0x98ee83","_0x1418ef","_0x3cfe95","_0x41d6d2","JSON","_0x42cb6a","_0x5bacb4","_0x556a03","Math"],"mappings":"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","sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar CoinCapConstant_1 = require(\"./CoinCapConstant\");\r\nvar MsgFactory_1 = require(\"./MsgFactory\");\r\nvar MdConstant_1 = require(\"../api/MdConstant\");\r\nvar MdUtils_1 = require(\"../api/MdUtils\");\r\nvar WebSocket = require('isomorphic-ws');\r\nvar CoinCapTransport = /** @class */ (function () {\r\n    function CoinCapTransport(callback) {\r\n        var _this = this;\r\n        this.subscriptions = {};\r\n        this.validIdList = [];\r\n        this._connected = false;\r\n        this.isConnected = function () {\r\n            return _this._connected;\r\n        };\r\n        this.connect = function (symbols) {\r\n            _this._connected = true;\r\n            _this.subscribe(symbols);\r\n            _this.setup();\r\n        };\r\n        this.cb = callback;\r\n    }\r\n    CoinCapTransport.prototype.subscribe = function (symbols) {\r\n        var uriList = \"\";\r\n        var first = true;\r\n        for (var i = 0; i < CoinCapConstant_1.CoinCapConstant.VALIDCOINS.length; i++) {\r\n            var symbol = CoinCapConstant_1.CoinCapConstant.VALIDCOINS[i].symbol;\r\n            var symbolId = MdConstant_1.MdConstant.COINS.indexOf(symbol);\r\n            var ccSymbolId = CoinCapConstant_1.CoinCapConstant.VALIDCOINS[i].id;\r\n            if (symbolId >= 0) {\r\n                this.validIdList[CoinCapConstant_1.CoinCapConstant.VALIDCOINS[i].id] = symbol;\r\n                this.subscriptions[ccSymbolId] = { symbol: symbol, id: symbolId };\r\n                if (!first) {\r\n                    uriList += ',';\r\n                }\r\n                first = false;\r\n                uriList += ccSymbolId;\r\n            }\r\n        }\r\n        this.coinCapUri = \"wss://ws.coincap.io/prices?assets=\" + uriList;\r\n    };\r\n    CoinCapTransport.prototype.setup = function () {\r\n        var _this = this;\r\n        this.socket = new WebSocket(this.coinCapUri);\r\n        this.socket.onmessage = function (msg) {\r\n            var cqMsg = MsgFactory_1.MsgFactory.priceMsg;\r\n            var data = JSON.parse(msg.data);\r\n            var keysList = Object.keys(data);\r\n            keysList.forEach(function (ccSymbolId) {\r\n                var price = Math.trunc(data[ccSymbolId] * CoinCapConstant_1.CoinCapConstant.DIV) / CoinCapConstant_1.CoinCapConstant.DIV;\r\n                cqMsg.buffer(MdUtils_1.MdUtils.getMsSinceMidnight(), _this.subscriptions[ccSymbolId].id, Math.trunc(price), Math.trunc(price % 1 * CoinCapConstant_1.CoinCapConstant.DIV), 0, 0, 0, 0, MdConstant_1.MdConstant.CoinCapTransport, 0);\r\n                _this.cb.on(cqMsg);\r\n            });\r\n        };\r\n    };\r\n    return CoinCapTransport;\r\n}());\r\nexports.CoinCapTransport = CoinCapTransport;\r\n"]}