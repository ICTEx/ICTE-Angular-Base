{"version":3,"sources":["lib.js"],"names":["Object","exports","Constant_1","require","TimeMsg_1","BuyMsg_1","SellMsg_1","RateMsg_1","WebSocket","HtuSocketIoTransport","_0x4a4972","_0x184d33","_0x19ef61","_0x271556","_0x2d1957","_0x3d37fc","_0x3a79f7","_0x377931","Error","_0x200c06","_0x1a7392","_0x204f45","_0x3f937a","_0xc16b26","_0x154203","_0x9cb36c"],"mappings":"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","sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Constant_1 = require(\"../../model/Constant\");\r\nvar TimeMsg_1 = require(\"../../parser/TimeMsg\");\r\nvar BuyMsg_1 = require(\"../../parser/BuyMsg\");\r\nvar SellMsg_1 = require(\"../../parser/SellMsg\");\r\nvar RateMsg_1 = require(\"../../parser/RateMsg\");\r\nvar WebSocket = require('isomorphic-ws');\r\nvar HtuSocketIoTransport = /** @class */ (function () {\r\n    function HtuSocketIoTransport(callback) {\r\n        var _this = this;\r\n        this.parsers = [];\r\n        this.utf8 = 'utf8';\r\n        this.uri = 'ws://186.74.247.202:10750';\r\n        this.isConnected = function () {\r\n            return _this._connected;\r\n        };\r\n        this.connect = function (symbols) {\r\n            _this.socket = new WebSocket(_this.uri);\r\n            _this._connected = true;\r\n            _this.setup();\r\n            _this.subscribe(symbols);\r\n        };\r\n        this.callback = callback;\r\n        this.parsers[Constant_1.Constant.Msg_Sys] = [];\r\n        this.parsers[Constant_1.Constant.Msg_Sys][Constant_1.Constant.Sub_SysTime] = new TimeMsg_1.TimeMsg();\r\n        this.parsers[Constant_1.Constant.Msg_Quote] = [];\r\n        this.parsers[Constant_1.Constant.Msg_Quote][Constant_1.Constant.Sub_Buy] = new BuyMsg_1.BuyMsg();\r\n        this.parsers[Constant_1.Constant.Msg_Quote][Constant_1.Constant.Sub_Sell] = new SellMsg_1.SellMsg();\r\n        this.parsers[Constant_1.Constant.Msg_Quote][Constant_1.Constant.Sub_Rate] = new RateMsg_1.RateMsg();\r\n    }\r\n    HtuSocketIoTransport.prototype.setup = function () {\r\n        var _this = this;\r\n        this.socket.onopen = function (e) {\r\n            _this._connected = true;\r\n        };\r\n        this.socket.onmessage = function (content) {\r\n            if (content.data.length === 0)\r\n                throw new Error('Empty data');\r\n            try {\r\n                var msg = content.data.toString(_this.utf8, Constant_1.Constant.Fld_Type, Constant_1.Constant.Fld_Type + 1);\r\n                var sub = content.data.toString(_this.utf8, Constant_1.Constant.Fld_SubType, Constant_1.Constant.Fld_SubType + 1);\r\n                if (msg == Constant_1.Constant.Msg_Sys && sub == Constant_1.Constant.Sub_SysTime) {\r\n                    var message = content.data.toString(_this.utf8, Constant_1.Constant.Fld_SubType + 1, content.data.length - 1);\r\n                    var cqMsg = _this.parsers[msg][sub];\r\n                    cqMsg.buffer(message);\r\n                    _this.callback.on(cqMsg);\r\n                }\r\n                else if (msg == Constant_1.Constant.Msg_Quote && sub == Constant_1.Constant.Sub_Rate) {\r\n                    var message = content.data.toString(_this.utf8, Constant_1.Constant.Fld_SubType + 1, content.data.length - 1);\r\n                    var cqMsg = _this.parsers[msg][sub];\r\n                    cqMsg.buffer(message); //TODO: Correct parameters for RateMsg\r\n                    _this.callback.on(cqMsg);\r\n                }\r\n            }\r\n            catch (e) {\r\n                throw new Error(\"Receive an invalid message - \" + e.message);\r\n            }\r\n        };\r\n        this.socket.onerror = function (errorEvent) {\r\n            //TODO:Error handler\r\n            throw new Error(errorEvent.message);\r\n        };\r\n        this.socket.onclose = function (closeEvent) {\r\n            //TODO: Handle disconnections\r\n            _this._connected = false;\r\n        };\r\n    };\r\n    HtuSocketIoTransport.prototype.subscribe = function (symbols) {\r\n        this.subs = symbols;\r\n    };\r\n    return HtuSocketIoTransport;\r\n}());\r\nexports.HtuSocketIoTransport = HtuSocketIoTransport;\r\n"]}