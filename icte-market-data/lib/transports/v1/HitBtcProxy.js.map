{"version":3,"sources":["lib.js"],"names":["__extends","_0x98f875","_0xb53b99","_0x3c5649","Object","Array","_0x357fbf","_0x501c4d","_0xcdc6b2","_0x193af3","exports","EventEmiter","require","HitBtcConstant_1","MdUtils_1","WebSocket","HitBtcProxy","_0x3b6d7c","_0x595cea","_0x3ff09e","_0xf6c737","_0x4bb92d","arguments","length","_0x3c2ff0","_0x237047","_0x351083","_0x37a093","_0x294c35","_0x15ec07","_0x31cd85","JSON","_0x265a8a","_0x4132f9","_0x11b0a1","_0x9d4d3f","_0x394c01","_0x5bef86","HitBtcConstant","PAIRS","symbol","bench","_0x3d059f","_0x2eda06","_0xc8f409","_0x3d7427","_0x2c6b2d","_0x225947","_0x42d5d1","_0x6ccc72","_0x363e37","_0xa69ce4"],"mappings":"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","sourcesContent":["\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar EventEmiter = require(\"events\");\r\nvar HitBtcConstant_1 = require(\"./HitBtcConstant\");\r\nvar MdUtils_1 = require(\"../api/MdUtils\");\r\nvar WebSocket = require('isomorphic-ws');\r\nvar HitBtcProxy = /** @class */ (function (_super) {\r\n    __extends(HitBtcProxy, _super);\r\n    function HitBtcProxy() {\r\n        var _this = _super.call(this) || this;\r\n        _this.subscription = {};\r\n        _this.logger = {\r\n            debug: function () {\r\n                var arg = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    arg[_i] = arguments[_i];\r\n                }\r\n                //console.log((new Date).toISOString(), 'DEBUG', ...arg)\r\n            },\r\n            info: function () {\r\n                var arg = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    arg[_i] = arguments[_i];\r\n                }\r\n                //console.log((new Date).toISOString(), 'INFO', ...arg)\r\n            },\r\n            warn: function () {\r\n                var arg = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    arg[_i] = arguments[_i];\r\n                }\r\n                //console.log((new Date).toISOString(), 'WARN', ...arg)\r\n            }\r\n        };\r\n        return _this;\r\n    }\r\n    HitBtcProxy.prototype.start = function () {\r\n        var _this = this;\r\n        var url = HitBtcConstant_1.HitBtcConstant.baseEndpoint;\r\n        this.webSocket = new WebSocket(url);\r\n        this.webSocket.onopen = function () {\r\n            _this.logger.info('HitBtc Transport connected.');\r\n            _this.emit(HitBtcConstant_1.HitBtcConstant.OPENEVENT, 'HitBtc Connection open');\r\n            _this.onConnected();\r\n        };\r\n        this.webSocket.onclose = function (reason) {\r\n            //TODO:Just for test\r\n            _this.logger.warn('*** HitBtc is closed!!', reason);\r\n            //TODO: Reconnection?\r\n            _this.emit(HitBtcConstant_1.HitBtcConstant.CLOSEEVENT, reason);\r\n        };\r\n        this.webSocket.onerror = function (error) {\r\n            //TODO:Just for test\r\n            _this.logger.warn('*** HitBtc ERROR!!', error);\r\n            _this.emit(HitBtcConstant_1.HitBtcConstant.ERROREVENT, error);\r\n        };\r\n        this.webSocket.onmessage = function (msg) {\r\n            _this.onMessage(JSON.parse(msg.data));\r\n        };\r\n    };\r\n    HitBtcProxy.prototype.onConnected = function () {\r\n        var _this = this;\r\n        var pairs = Object.keys(HitBtcConstant_1.HitBtcConstant.PAIRS);\r\n        var id = MdUtils_1.MdUtils.getMsSinceMidnight();\r\n        pairs.forEach(function (pair) {\r\n            _this.webSocket.send(\"{\\\"method\\\":\\\"subscribeTicker\\\",\\\"params\\\":{\\\"symbol\\\":\\\"\" + pair + \"\\\"},\\\"id\\\": \" + id + \"}\");\r\n            _this.webSocket.send(\"{\\\"method\\\":\\\"subscribeOrderbook\\\",\\\"params\\\":{\\\"symbol\\\":\\\"\" + pair + \"\\\"},\\\"id\\\": \" + id + \"}\");\r\n            _this.subscription[pair] = {\r\n                symbolPair: pair,\r\n                symbolId: HitBtcConstant_1.HitBtcConstant.PAIRS[pair].symbol,\r\n                benchId: HitBtcConstant_1.HitBtcConstant.PAIRS[pair].bench,\r\n                bid: 0,\r\n                ask: 0,\r\n                bidSize: 0,\r\n                askSize: 0,\r\n                price: 0,\r\n                size: 0,\r\n                volume: 0\r\n            };\r\n        });\r\n    };\r\n    HitBtcProxy.prototype.onMessage = function (msg) {\r\n        if (msg.method && msg.params) {\r\n            switch (msg.method) {\r\n                case HitBtcConstant_1.HitBtcConstant.snapshotOrderbook:\r\n                    this.onSnapShot(msg, HitBtcConstant_1.HitBtcConstant.SNAPSHOTEVENT);\r\n                    break;\r\n                case HitBtcConstant_1.HitBtcConstant.ticker:\r\n                    var symbol = msg.params.symbol;\r\n                    this.subscription[symbol].price = msg.params.last;\r\n                    this.subscription[symbol].volume = msg.params.volume;\r\n                    this.subscription[symbol].bid = msg.params.bid;\r\n                    this.subscription[symbol].ask = msg.params.ask;\r\n                    this.emit(HitBtcConstant_1.HitBtcConstant.TICKEREVENT, symbol, this.subscription[symbol]);\r\n                    break;\r\n                case HitBtcConstant_1.HitBtcConstant.updateOrderbook:\r\n                    this.onSnapShot(msg, HitBtcConstant_1.HitBtcConstant.UPDATEBOOKEVENT);\r\n                    break;\r\n            }\r\n        }\r\n        else if (msg.id) {\r\n            //TODO: any important messages from here?\r\n        }\r\n    };\r\n    HitBtcProxy.prototype.onSnapShot = function (msg, eventType) {\r\n        var symbol = msg.params.symbol;\r\n        var update = false;\r\n        msg.params.bid.sort(function (a, b) { return (a.price > b.price) ? 1 : ((b.price > a.price) ? -1 : 0); });\r\n        msg.params.ask.sort(function (a, b) { return (a.price > b.price) ? -1 : ((b.price > a.price) ? 1 : 0); });\r\n        if (msg.params.ask.length > 0) {\r\n            if (msg.params.ask[0].price < this.subscription[symbol].ask) {\r\n                this.subscription[symbol].ask = msg.params.ask[0].price;\r\n                this.subscription[symbol].askSize = msg.params.ask[0].size;\r\n                update = true;\r\n            }\r\n        }\r\n        if (msg.params.bid.length > 0) {\r\n            if (msg.params.bid[0].price > this.subscription[symbol].bid) {\r\n                this.subscription[symbol].bid = msg.params.bid[0].price;\r\n                this.subscription[symbol].bidSize = msg.params.bid[0].size;\r\n                update = true;\r\n            }\r\n        }\r\n        if (update) {\r\n            this.emit(eventType, symbol, this.subscription[symbol]);\r\n        }\r\n    };\r\n    return HitBtcProxy;\r\n}(EventEmiter));\r\nexports.HitBtcProxy = HitBtcProxy;\r\n"]}