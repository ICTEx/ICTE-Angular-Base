{"version":3,"sources":["lib.js"],"names":["__extends","_0x176177","_0x4bd734","_0x15a7ab","Object","Array","_0x35323f","_0x28e6ab","_0x3e1883","_0x2e7c9a","exports","EventEmiter","require","PoloniexConstants_1","WebSocket","PoloniexProxy","_0x14602b","_0x17186f","_0x4ed5b5","_0x1636eb","setInterval","_0x3c80e4","clearInterval","_0x826ff7","process","_0x282e50","_0x284a3e","JSON","_0x288fd2","_0x3931f3","Error","_0x3015b3","_0x4d513a","_0x4d7409","_0x21de52","_0x5167cd","_0x43b314","_0x51c4cc","Math","Date","_0x198437","_0x222d7b","_0x4ebac4","_0x24c3bc","_0x50b9b0","_0x3a379e","arguments","_0x55d943","_0x3a5228","_0x351dce","_0x2b5a11","_0x5ae0c7","_0x6e12bc","_0x31e76f","_0x4a1826","_0x565a92","_0x4d3e7c"],"mappings":"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","sourcesContent":["\"use strict\";\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n/*\r\n By: Marco A. Barragan @ ICTE\r\n  */\r\nvar EventEmiter = require(\"events\");\r\nvar PoloniexConstants_1 = require(\"./PoloniexConstants\");\r\nvar WebSocket = require('isomorphic-ws');\r\n/***\r\n * Poloniex Wrapper Class\r\n */\r\nvar PoloniexProxy = /** @class */ (function (_super) {\r\n    __extends(PoloniexProxy, _super);\r\n    function PoloniexProxy() {\r\n        var _this = _super.call(this) || this;\r\n        _this.wsState = WebSocket.CLOSE;\r\n        _this.commandsQueue = [];\r\n        _this.webSocket = new WebSocket(PoloniexConstants_1.PoloniexConstants.poloniexUrl, [], PoloniexConstants_1.PoloniexConstants.header);\r\n        _this.webSocket.onopen = function (e) {\r\n            _this._keepAliveInterval = setInterval(function () {\r\n                _this.webSocket.send(\".\");\r\n            }, PoloniexConstants_1.PoloniexConstants.PINGTIME);\r\n            _this.wsState = e.target.readyState;\r\n            while (_this.commandsQueue.length)\r\n                _this.send.apply(_this, _this.commandsQueue.shift());\r\n            _this.emit(PoloniexConstants_1.PoloniexConstants.OPENEVENT, \"Connected\");\r\n        };\r\n        _this.webSocket.onmessage = function (content) {\r\n            var sequence = 0;\r\n            var message = JSON.parse(content.data);\r\n            if (content.data.length === 0)\r\n                throw new Error('Empty data');\r\n            if ('error' in message)\r\n                return _this.emit('error', message);\r\n            var cid = message.shift();\r\n            if (cid == PoloniexConstants_1.PoloniexConstants.TICKER) {\r\n                sequence = -1;\r\n                return _this._marketEvent(cid, sequence, message);\r\n            }\r\n            // if cid is currencyPair channel\r\n            if (PoloniexConstants_1.PoloniexConstants.MINPAIR < cid && cid < PoloniexConstants_1.PoloniexConstants.MAXPAIR) {\r\n                sequence = message[0];\r\n                return _this._marketEvent(cid, sequence, message);\r\n            }\r\n            if (cid === PoloniexConstants_1.PoloniexConstants.HEARTBEAT)\r\n                return;\r\n        };\r\n        _this.webSocket.onerror = function (errorEvent) {\r\n            if (/403/.test(errorEvent.message)) {\r\n                clearInterval(_this._keepAliveInterval);\r\n                _this.webSocket.terminate();\r\n                _this.emit(PoloniexConstants_1.PoloniexConstants.ERROREVENT, \"Poloniex is protected with CloudFlare & reCaptcha.\");\r\n                process.exit();\r\n            }\r\n            else {\r\n                _this.emit(PoloniexConstants_1.PoloniexConstants.ERROREVENT, errorEvent.message);\r\n            }\r\n        };\r\n        _this.webSocket.onclose = function (closeEvent) {\r\n            clearInterval(_this._keepAliveInterval);\r\n            _this.emit(PoloniexConstants_1.PoloniexConstants.CLOSEEVENT, closeEvent);\r\n        };\r\n        _this.subscribe();\r\n        return _this;\r\n    }\r\n    PoloniexProxy.prototype.subscribe = function () {\r\n        var _this = this;\r\n        this.send(PoloniexConstants_1.PoloniexConstants.SUBSCRIBE, \"1002\");\r\n        var pairs = Object.keys(PoloniexConstants_1.PoloniexConstants.validPairs);\r\n        pairs.forEach(function (pair) {\r\n            _this.send(PoloniexConstants_1.PoloniexConstants.SUBSCRIBE, pair);\r\n        });\r\n    };\r\n    ;\r\n    PoloniexProxy.prototype.send = function (command, channel) {\r\n        if (this.wsState != WebSocket.OPEN) {\r\n            return this.commandsQueue.push([command, channel]);\r\n        }\r\n        var sign = PoloniexConstants_1.PoloniexConstants.sign;\r\n        var key = PoloniexConstants_1.PoloniexConstants.key;\r\n        var payload = \"nonce=\" + (Math.round(new Date().getTime() / 1000));\r\n        var dataToSend = JSON.stringify({ command: command, channel: channel, key: key, payload: payload, sign: sign });\r\n        this.webSocket.send(dataToSend);\r\n    };\r\n    PoloniexProxy.prototype._marketEvent = function (cid, sequence) {\r\n        var message = [];\r\n        for (var _i = 2; _i < arguments.length; _i++) {\r\n            message[_i - 2] = arguments[_i];\r\n        }\r\n        if (sequence > 1) {\r\n            for (var _a = 0, message_1 = message; _a < message_1.length; _a++) {\r\n                var messageData = message_1[_a];\r\n                messageData.shift();\r\n                var rawData = messageData.shift();\r\n                var dataToSend = rawData.shift();\r\n                var eventName = dataToSend.shift();\r\n                this.emit(eventName, cid, sequence, dataToSend);\r\n            }\r\n        }\r\n        else {\r\n            var rawMessage = message.shift();\r\n            //check if there is more than one update\r\n            for (var i in rawMessage) {\r\n                //Skip the first null in the message\r\n                if (rawMessage[i] != null) {\r\n                    var basicData = rawMessage[i];\r\n                    var pairId = basicData[0];\r\n                    this.emit(PoloniexConstants_1.PoloniexConstants.TICKEREVENT, pairId, basicData);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    return PoloniexProxy;\r\n}(EventEmiter));\r\nexports.PoloniexProxy = PoloniexProxy;\r\n"]}